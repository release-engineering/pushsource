
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>User Guide &#8212; pushsource  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Source" href="sources/base.html" />
    <link rel="prev" title="pushsource" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="user-guide">
<span id="userguide"></span><h1><a class="toc-backref" href="#id1">User Guide</a><a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<p>The pushsource library provides a common interface over various sources
of content, yielding metadata on each piece of content found.
These pieces of metadata are referred to as “push items”, as the main use-case
for the library is in the creation of content publishing tools.</p>
<p>Here are some examples of push items:</p>
<ul class="simple">
<li><p>RPMs obtained from a <a class="reference external" href="https://pagure.io/koji/">koji</a> server.</p></li>
<li><p>RPMs and generic files obtained from a local directory.</p></li>
<li><p>Advisories and RPMs obtained from Errata Tool.</p></li>
</ul>
<p>Typical usage of the library involves obtaining a <a class="reference internal" href="sources/base.html#pushsource.Source" title="pushsource.Source"><code class="xref py py-class docutils literal notranslate"><span class="pre">Source</span></code></a>
instance and iterating over <a class="reference internal" href="model/base.html#pushsource.PushItem" title="pushsource.PushItem"><code class="xref py py-class docutils literal notranslate"><span class="pre">PushItem</span></code></a> objects discovered
by the source.</p>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#user-guide" id="id1">User Guide</a></p>
<ul>
<li><p><a class="reference internal" href="#obtaining-a-source-by-url" id="id2">Obtaining a source by URL</a></p></li>
<li><p><a class="reference internal" href="#available-backends" id="id3">Available backends</a></p></li>
<li><p><a class="reference internal" href="#processing-push-items" id="id4">Processing push items</a></p></li>
<li><p><a class="reference internal" href="#implementing-a-backend" id="id5">Implementing a backend</a></p></li>
<li><p><a class="reference internal" href="#binding-partially-configured-backends" id="id6">Binding partially-configured backends</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="obtaining-a-source-by-url">
<span id="urls"></span><h2><a class="toc-backref" href="#id2">Obtaining a source by URL</a><a class="headerlink" href="#obtaining-a-source-by-url" title="Permalink to this headline">¶</a></h2>
<p>In most cases, the recommended method of obtaining a <a class="reference internal" href="sources/base.html#pushsource.Source" title="pushsource.Source"><code class="xref py py-class docutils literal notranslate"><span class="pre">Source</span></code></a>
is to provide a URL to the <a class="reference internal" href="sources/base.html#pushsource.Source.get" title="pushsource.Source.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a> method.
URLs are used to select a backend and provide parameters.</p>
<p>URLs use one of the following syntaxes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>backend:remote_url?arg1=val1&amp;arg2=val2&amp;...
backend:arg1=val1&amp;arg2=val2&amp;...
backend:
</pre></div>
</div>
<p>The first syntax with a <cite>remote_url</cite> may be used in the common case where the
desired backend itself needs the URL of a remote service in order to function.</p>
<p>The second syntax omits the <cite>remote_url</cite> in cases where the backend does not
accept a URL.</p>
<p>The final syntax is used in cases where the backend does not require any arguments
in order to function.</p>
<p>When using URLs to obtain a source, arguments may consist of only strings and lists
of strings. By convention, most backends accept lists both by repeating the argument
name multiple times, and also by comma-separated values.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">backend</span><span class="p">:</span><span class="n">list_arg</span><span class="o">=</span><span class="n">val1</span><span class="o">&amp;</span><span class="n">list_arg</span><span class="o">=</span><span class="n">val2</span>
<span class="c1"># Is equivalent to:</span>
<span class="n">backend</span><span class="p">:</span><span class="n">list_arg</span><span class="o">=</span><span class="n">val1</span><span class="p">,</span><span class="n">val2</span>
</pre></div>
</div>
<p>Here are some example URLs:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span># Load some RPMs from the Fedora Project&#39;s koji
koji:https://koji.fedoraproject.org/kojihub?rpm=python3-3.7.5-2.fc31.x86_64.rpm,python3-3.7.5-2.fc31.src.rpm

# Load an advisory from Errata Tool
errata:https://errata.example.com/?errata=RHBA-2020:1234

# A hypothetical backend which accepts no arguments
mock:
</pre></div>
</div>
</section>
<section id="available-backends">
<h2><a class="toc-backref" href="#id3">Available backends</a><a class="headerlink" href="#available-backends" title="Permalink to this headline">¶</a></h2>
<p>The pushsource library includes the following backends.
For detailed information, see the API reference of the associated class.</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 5%" />
<col style="width: 45%" />
<col style="width: 20%" />
<col style="width: 30%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Name</p></th>
<th class="head"><p>Examples</p></th>
<th class="head"><p>Class</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>koji</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">koji:https://koji.fedoraproject.org?rpm=python3-3.7.5-2.fc31.x86_64.rpm</span></code></p></td>
<td><p><a class="reference internal" href="sources/koji.html#pushsource.KojiSource" title="pushsource.KojiSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">KojiSource</span></code></a></p></td>
<td><p>Obtain RPMs, container images and other content
from a koji server</p></td>
</tr>
<tr class="row-odd"><td><p>staged</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">staged:/mnt/vol/my/staged/content</span></code></p></td>
<td><p><a class="reference internal" href="sources/staged.html#pushsource.StagedSource" title="pushsource.StagedSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">StagedSource</span></code></a></p></td>
<td><p>Obtain RPMs, files, AMIs and other content from
locally mounted filesystem</p></td>
</tr>
<tr class="row-even"><td><p>errata</p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">errata:https://errata.example.com?errata=RHBA-2020:1234</span></code></p></td>
<td><p><a class="reference internal" href="sources/errata.html#pushsource.ErrataSource" title="pushsource.ErrataSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">ErrataSource</span></code></a></p></td>
<td><p>Obtain RPMs, container images and advisory
metadata from Errata Tool</p></td>
</tr>
</tbody>
</table>
</section>
<section id="processing-push-items">
<h2><a class="toc-backref" href="#id4">Processing push items</a><a class="headerlink" href="#processing-push-items" title="Permalink to this headline">¶</a></h2>
<p>Once a <code class="docutils literal notranslate"><span class="pre">Source</span></code> instance has been obtained, it can be iterated over to obtain
instances of <a class="reference internal" href="model/base.html#pushsource.PushItem" title="pushsource.PushItem"><code class="xref py py-class docutils literal notranslate"><span class="pre">PushItem</span></code></a>.</p>
<p>Each object yielded by the source may be an instance of any <code class="docutils literal notranslate"><span class="pre">PushItem</span></code> subclass,
depending on the type of content loaded by the source.  For example, RPMs will be
yielded as instances of <a class="reference internal" href="model/rpm.html#pushsource.RpmPushItem" title="pushsource.RpmPushItem"><code class="xref py py-class docutils literal notranslate"><span class="pre">RpmPushItem</span></code></a> and errata will be yielded
as instances of <a class="reference internal" href="model/errata.html#pushsource.ErratumPushItem" title="pushsource.ErratumPushItem"><code class="xref py py-class docutils literal notranslate"><span class="pre">ErratumPushItem</span></code></a>.</p>
<p>Commonly, different kinds of processing will be needed for different kinds of push items.
In this case, it’s recommended to use <a class="reference external" href="https://docs.python.org/3/library/functions.html#isinstance" title="(in Python v3.9)"><code class="xref py py-func docutils literal notranslate"><span class="pre">isinstance()</span></code></a> checks to dispatch each push
item appropriately.</p>
<p>Consider tolerating push items of an unknown type (perhaps with a warning). This will ensure
your code is forwards-compatible with later versions of this library, which may add new types
of push items to existing sources.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">Source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="o">...</span><span class="p">)</span> <span class="k">as</span> <span class="n">source</span><span class="p">:</span>
  <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">source</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">RpmPushItem</span><span class="p">):</span>
      <span class="n">publish_rpm</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">ErratumPushItem</span><span class="p">):</span>
      <span class="n">publish_erratum</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">FilePushItem</span><span class="p">):</span>
      <span class="n">publish_file</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">LOG</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unexpected push item type: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="implementing-a-backend">
<span id="implementing"></span><h2><a class="toc-backref" href="#id5">Implementing a backend</a><a class="headerlink" href="#implementing-a-backend" title="Permalink to this headline">¶</a></h2>
<p>New backends can be registered with the library, making them accessible via URL.
To implement a backend, follow these steps:</p>
<ul>
<li><p>Create a class inheriting from <a class="reference internal" href="sources/base.html#pushsource.Source" title="pushsource.Source"><code class="xref py py-class docutils literal notranslate"><span class="pre">Source</span></code></a>.</p></li>
<li><p>In your constructor, add any arguments you’d like to be usable in URLs for your backend,
while following these conventions:</p>
<blockquote>
<div><ul class="simple">
<li><p>Remember that all arguments from URLs will be provided as strings.</p></li>
<li><p>Accept a <cite>url</cite> argument if and only if you want your backend URL to accept a URL
immediately after the backend scheme (as in example <code class="docutils literal notranslate"><span class="pre">backend:url?arg=val&amp;arg=val&amp;...</span></code>).</p></li>
<li><p>If your backend uses a customizable number of threads, use an argument named <cite>threads</cite>
for configuring the number of threads.</p></li>
<li><p>If your backend has a customizable timeout, use an argument named <cite>timeout</cite> accepting
a number of seconds.</p></li>
</ul>
</div></blockquote>
</li>
<li><dl class="simple">
<dt>Implement the <code class="docutils literal notranslate"><span class="pre">__iter__</span></code> method, while following conventions:</dt><dd><ul class="simple">
<li><p>Lazy loading of data is recommended where practical; i.e. prefer to implement a generator
which yields each piece of data as it is ready, rather than eagerly loading all data
into a list.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>If your class allocates any resources which should be cleaned up when no longer needed,
implement <code class="docutils literal notranslate"><span class="pre">__enter__</span></code> and <code class="docutils literal notranslate"><span class="pre">__exit__</span></code> methods to manage them.</p></li>
<li><p>Call the <a class="reference internal" href="sources/base.html#pushsource.Source.register_backend" title="pushsource.Source.register_backend"><code class="xref py py-class docutils literal notranslate"><span class="pre">register_backend</span></code></a> method providing your backend’s name
and class as arguments.</p></li>
</ul>
<p>After following the above steps, instances of your source can be obtained by
<a class="reference internal" href="sources/base.html#pushsource.Source.get" title="pushsource.Source.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get()</span></code></a>, in the same manner as backends built-in to the library.</p>
</section>
<section id="binding-partially-configured-backends">
<span id="binding"></span><h2><a class="toc-backref" href="#id6">Binding partially-configured backends</a><a class="headerlink" href="#binding-partially-configured-backends" title="Permalink to this headline">¶</a></h2>
<p>For developers integrating this library into an environment where certain parameters
are known ahead of time, it’s possible and recommended to preconfigure backends,
making them less cumbersome to use and hiding configuration details. This can be done
by registering a new backend which acts as an alias along with a set of arguments
to an existing backend.</p>
<p>For example: this library ships a <cite>koji</cite> backend. If we are developing a tool which
frequently is used with Fedora Koji, it would be cumbersome to require the user to
pass the Fedora Koji URL every time the source is used. This can be fixed by
creating a <cite>fedkoji</cite> alias, which delegates to the <cite>koji</cite> backend with some arguments
pre-filled.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># make a &#39;fedkoji&#39; backend which is simply the koji backend</span>
<span class="c1"># pointed at a particular URL</span>
<span class="n">fedkoji_backend</span> <span class="o">=</span> <span class="n">Source</span><span class="o">.</span><span class="n">get_partial</span><span class="p">(</span><span class="s1">&#39;koji:https://koji.fedoraproject.org/kojihub&#39;</span><span class="p">)</span>
<span class="n">Source</span><span class="o">.</span><span class="n">register_backend</span><span class="p">(</span><span class="s1">&#39;fedkoji&#39;</span><span class="p">,</span> <span class="n">fedkoji_backend</span><span class="p">)</span>

<span class="c1"># fedora koji now accessible without specifying URL</span>
<span class="n">Source</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;fedkoji:rpm=python3-3.7.5-2.fc31.x86_64.rpm,...&#39;</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">pushsource</a></h1>



<p class="blurb">A library to load push items from a variety of sources</p>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#obtaining-a-source-by-url">Obtaining a source by URL</a></li>
<li class="toctree-l2"><a class="reference internal" href="#available-backends">Available backends</a></li>
<li class="toctree-l2"><a class="reference internal" href="#processing-push-items">Processing push items</a></li>
<li class="toctree-l2"><a class="reference internal" href="#implementing-a-backend">Implementing a backend</a></li>
<li class="toctree-l2"><a class="reference internal" href="#binding-partially-configured-backends">Binding partially-configured backends</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sources/base.html">Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="sources/staged.html">Source: staged</a></li>
<li class="toctree-l1"><a class="reference internal" href="sources/koji.html">Source: koji</a></li>
<li class="toctree-l1"><a class="reference internal" href="sources/errata.html">Source: errata</a></li>
<li class="toctree-l1"><a class="reference internal" href="model/base.html">Push items</a></li>
<li class="toctree-l1"><a class="reference internal" href="model/files.html">Push items: file</a></li>
<li class="toctree-l1"><a class="reference internal" href="model/rpm.html">Push items: RPM</a></li>
<li class="toctree-l1"><a class="reference internal" href="model/modulemd.html">Push items: modulemd</a></li>
<li class="toctree-l1"><a class="reference internal" href="model/errata.html">Push items: errata</a></li>
<li class="toctree-l1"><a class="reference internal" href="model/containers.html">Push items: containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="model/ami.html">Push items: AMI</a></li>
<li class="toctree-l1"><a class="reference internal" href="model/productid.html">Push items: productid</a></li>
<li class="toctree-l1"><a class="reference internal" href="model/comps.html">Push items: comps.xml</a></li>
<li class="toctree-l1"><a class="reference internal" href="schema/staged.html">Schema: staged</a></li>
<li class="toctree-l1"><a class="reference internal" href="schema/errata.html">Schema: errata</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://github.com/release-engineering/pushsource">Source</a></li>
    
    <li class="toctree-l1"><a href="https://pypi.org/project/pushsource">PyPI</a></li>
    
    <li class="toctree-l1"><a href="genindex.html">Index</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">pushsource</a></li>
      <li>Next: <a href="sources/base.html" title="next chapter">Source</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Red Hat.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/userguide.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/release-engineering/pushsource" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>